{% extends "esign/base_login.html" %}
{% block content %}
{% load static %}
<div class="d-flex justify-content-center align-items-center">
  <div class="container-fluid">
    <div class="row">
      <div class="col-sm-12 col-lg-8 offset-lg-2">
        <div class="login-wrapper">
    <form method="post" id="signupForm">
      {% csrf_token %}
      <div class="step mt-5">
        <div class="row">
         <div class="col-sm-12 col-md-6">
          <h3 class="">Let’s start!</h3>
            <p class="text-muted mb-4">Let’s get the basics. Enter your info below.</p>

          <div class="row">
            <div class="col-sm-12 col-md-6">
              <div class="mb-3">
                <label class="form-label" for="username">First Name<span style="color: red;"> *</span></label>
                <input type="text" name="username" id="username" class="form-control" placeholder="First Name" required
                value="{{ request.POST.username|default_if_none:'' }}">
              </div>
            </div>
            <div class="col-sm-12 col-md-6">
              <div class="mb-3">
                <label class="form-label" for="userLastName">Last Name<span style="color: red;"> *</span></label>
                <input type="text" name="userLastName" id="userLastName" class="form-control" placeholder="Last Name" required
                value="{{ request.POST.userLastName|default_if_none:'' }}">
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-12 col-md-12">
              <div class="mb-3">
                <label class="form-label" for="userPhone">Phone<span style="color: red;"> *</span></label>
                <input type="text" name="userPhone" class="form-control" placeholder="Phone Number" required
                value="{{ request.POST.userPhone|default_if_none:'' }}">
              </div>
            </div>
          </div>
          <div class="text-center mt-3">
            <button type="button" class="btn btn-primary w-100" onclick="goToStep(1)">Next</button>
            </div>

          </div>
          <div class="col-sm-12 col-md-6">
            <div class="card rounded">
              <div class="bg-white position-relative rounded">  
                <div class="position-absolute w-75" style="left: 60px; bottom: 30px;">
              <div id="signaturePreview" class="fs-2 mt-2 text-black" style="font-family: 'Oooh Baby', cursive;">

              </div>
              <span class="small text-black d-block border-top">Signature</span>
            </div>
              <img src="{% static 'assets/images/sign-sample.jpg' %}" alt="" class="img-fluid rounded">
            </div>
          </div>
        </div>
      </div>
    </div>

      <div class="step d-none mt-5">
        <div class="row">
         <div class="col-sm-12 col-md-6">
          <h3 class="">Check your email</h3>
            <p class="text-muted mb-4">A temporary confirmation code was sent to <strong>dinesh.siwas@rmail.team</strong></p>

          <div class="mb-5">
            <label class="form-label" for="emailVerificationCode">Verification Code <span style="color: red;"> *</span></label>
            <input type="text" name="emailVerificationCode" id="emailVerificationCode" class="form-control" placeholder="6 Digit Verification Code" required value="">
          </div>
          <p><span class="btn btn-sm btn btn-outline-secondary me-2">Send my code again</span> <a href="/signup" class="btn btn-sm btn btn-outline-secondary">Use a different email address</a></p>
          <div class="text-center mt-3">
            <button type="button" class="btn btn-primary w-100" onclick="goToStep(2)">Next</button>
          </div>
        </div>
        <div class="col-sm-12 col-md-6">
          <p>Graphic Div</p>
        </div>
      </div>
    </div>

    <div class="step d-none mt-5">
      <div class="row">
       <div class="col-sm-12 col-md-6">
        <h3 class="">Secure Your Account</h3>
          <p class="text-muted mb-4">To enhance the security of your account, EazeeSign needs to verify that it’s really you. Please enter your phone number to confirm your identity by SMS and we will send you a one-time 6-digit code.</p>

        <div class="mb-5">
          <label class="form-label" for="userPhone">Phone <span style="color: red;"> *</span></label>
          <input type="text" name="userPhone" class="form-control" placeholder="Phone Number" required
          value="{{ request.POST.userPhone|default_if_none:'' }}">
        </div>
        <p class="small">Message and data rates may apply. We will only use your phone number provided here for identity verification purposes. By choosing to Send Code, you agree to the <a href="/terms_of_service" class="d-inline-block">Terms of Service</a> and <a href="/privacy_policy" class="d-inline-block">Privacy Policy</a>.</p>
        <div class="text-center mt-3">
          <button type="button" class="btn btn-primary w-100" onclick="goToStep(3)">Send Code</button>
        </div>
      </div>
      <div class="col-sm-12 col-md-6">
        <p>Graphic Div</p>
      </div>
    </div>
  </div>

  <div class="step d-none mt-5">
    <div class="row">
     <div class="col-sm-12 col-md-6">
      <h3 class="">Verify your number</h3>
        <p class="text-muted mb-4">Enter the temporary verification code sent to <strong>9988776655</strong></p>

      <div class="mb-2">
        <label class="form-label" for="phoneVerificationCode">Verification Code <span style="color: red;"> *</span></label>
        <input type="text" name="phoneVerificationCode" id="phoneVerificationCode" class="form-control" placeholder="6 Digit Verification Code" required value="">
      </div>
      <!-- <p class="mb-5"><button class="btn btn-sm btn btn-outline-secondary me-2">Resend code again</button> <button class="btn btn-sm btn btn-outline-secondary">Use a different phone number</button></p> -->

      <p class="small">By choosing to verify, you agree to the <a href="/terms_of_service" class="d-inline-block">Terms of Service</a> and <a href="/privacy_policy" class="d-inline-block">Privacy Policy</a>.</p>
      <div class="text-center mt-3">
        <button type="button" class="btn btn-primary w-100" onclick="goToStep(4)">Verify</button>
      </div>
    </div>
    <div class="col-sm-12 col-md-6">
      <p>Graphic Div</p>
    </div>
  </div>
</div>

<div class="step d-none mt-5">
  <div class="row">
   <div class="col-sm-12 col-md-6">
    <h3 class="">Set your password</h3>
      <p class="text-muted mb-4">Your account login will be <strong>dinesh.siwas@rmail.team</strong></p>

    <div class="mb-5 position-relative">
      <label class="form-label" for="userPassword">Password <span style="color: red;">*</span></label>
      <div class="input-group">
        <input type="password" name="userPassword" id="userPassword" class="form-control" placeholder="Password" required>
        <button type="button" class="btn btn-outline-secondary" id="togglePassword">
          <i class="fas fa-eye"></i>
        </button>
      </div>
      <div id="passwordHelp" class="form-text mt-3">
        <p class="small text-muted mb-1"><i class="fas fa-check me-1"></i> Must be atleast 6 characters long.</p>
        <p class="small text-muted"><i class="fas fa-check me-1"></i> Must contain the characters (A–Z, a–z, 0–9, @#).</p>
      </div>
    </div>

    <div class="text-center">
      <button type="button" class="btn btn-primary w-100">Next</button>
    </div>
  </div>
  <div class="col-sm-12 col-md-6">
    <p>Graphic Div</p>
  </div>
</div>
</div>

</form>

<script>
  const togglePassword = document.querySelector("#togglePassword");
  const password = document.querySelector("#userPassword");
  const toggleConfirmPassword = document.querySelector("#toggleConfirmPassword");
  const confirmPassword = document.querySelector("#confirmPasswordHelp");
  const passwordHelp = document.getElementById("passwordHelp");
  const confirmError = document.getElementById("confirmError");
  const signupForm = document.getElementById("signupForm");

            // Toggle show/hide
            togglePassword.addEventListener("click", function () {
              const type = password.getAttribute("type") === "password" ? "text" : "password";
              password.setAttribute("type", type);
              this.querySelector("i").classList.toggle("fa-eye");
              this.querySelector("i").classList.toggle("fa-eye-slash");
            });

            toggleConfirmPassword.addEventListener("click", function () {
              const type = confirmPassword.getAttribute("type") === "password" ? "text" : "password";
              confirmPassword.setAttribute("type", type);
              this.querySelector("i").classList.toggle("fa-eye");
              this.querySelector("i").classList.toggle("fa-eye-slash");
            });

            // Password validation regex
            function validatePasswordStrength(pwd) {
              const strongRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@#])[A-Za-z\d@#]{8,}$/;
              return strongRegex.test(pwd);
            }

            // Real-time validation
            password.addEventListener("input", () => {
              if (!validatePasswordStrength(password.value)) {
                passwordHelp.innerHTML = '<i class="fas fa-exclamation-circle me-1"></i> Password must include upper, lower, number, symbol & be ≥8 characters.';
                passwordHelp.classList.add("text-danger");
                passwordHelp.classList.remove("text-success");
              } else {
                passwordHelp.innerHTML = '<i class="fas fa-check-circle me-1"></i> Strong password.';
                passwordHelp.classList.remove("text-danger");
                passwordHelp.classList.add("text-success");
              }
            });

            confirmPassword.addEventListener("input", () => {
              confirmError.style.display = confirmPassword.value !== password.value ? "block" : "none";
            });

            // ✅ Final form validation before submit
            signupForm.addEventListener("submit", (e) => {
              let valid = true;

              if (!validatePasswordStrength(password.value)) {
                valid = false;
                password.focus();
                alert("Please enter a strong password (must include upper, lower, number, symbol & be ≥8 characters).");
              } else if (confirmPassword.value !== password.value) {
                valid = false;
                confirmPassword.focus();
                alert("Passwords do not match. Please recheck.");
              }

              if (!valid) e.preventDefault(); // stop submission
            });
          </script>

        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}
